{% load static %}

<!-- Modal -->
<div class="modal fade" id="sabores_{{tam.id}}" tabindex="-1" aria-labelledby="sabores_Label" aria-hidden="true">
	<div class="modal-dialog modal-lg modal-dialog-scrollable">
	  <div class="modal-content">
		<div class="modal-header">
		  <h1 class="modal-title fs-5" id="sabores_Label">Escolha de Sabores</h1>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div> 
		
		<div class="text-center p-3">
			<img class="img-fluid" width="180" src="https://th.bing.com/th/id/OIP.VCQQ1ZvdoxmewQHMn1s5vgHaE7?rs=1&pid=ImgDetMain" alt="">
			<h3>Pizza Tamanho {{tam.tipo}} </h3>
			<p>Você pode escolher uma pizza com no máximo {{tam.quantidade_fatias}} fatias</p>  
		</div>
		
		<div class="modal-body"> 
			{% for t in tipo_sabor %}
				<div class="d-flex justify-content-between bg-light border-3 p-3"> 
					<span class="fs-4 fw-bold">Sabores {{t.tipo}}</span>
					</span>
				</div> 
    
                <div class="d-flex justify-content-end align-items-center p-3">
                    <span class="fs-4 fw-bold"> <span id="resultselsabor">0</span> / {{emb.capacidade_maxima_bolas}} 
                    <span class="badge bg-secondary">Máximo</span></span> 
                </div> 
				
				{% for s in t.tipo_sabor.all %} 
					<div class="d-flex align-items-center p-3 border">
						<div class="p-2 flex-grow-1 text-start">
							<img src="https://th.bing.com/th/id/OIP.VCQQ1ZvdoxmewQHMn1s5vgHaE7?rs=1&pid=ImgDetMain" class="" width="80" alt="..."> 
							<br><span class="fw-bold">{{s.nome}}</span> 
						</div>
						<div class="qty ms-auto d-flex align-items-center">
							<span class="minus bg-dark text-white px-3 py-1">-</span>
                            <input type="hidden" class="selsabor" id="selsabor" data-capmax="{{tam.quantidade_fatias}}">
                            <input type="number" class="count" data-saborid="{{s.id}}" name="qty" value="0">
							<span class="plus bg-dark text-white px-3 py-1">+</span>
						</div>
					</div>
				{% endfor %}
			{% endfor %}
 		</div>  
		<div class="modal-footer">
		  <button type="button" class="btn btn-primary btn-lg">Adicionar</button> 
		</div>
	  </div>
	</div>
  </div>


  {% block scripts %}
  <script>
    $(document).ready(function(){
            $('.count').prop('disabled', true);
        
            function atualizarTotalSelecionado() {
                var totalSelecionado = 0;
                $('.count').each(function() {
                    totalSelecionado += parseInt($(this).val());
                });
                $('#resultselsabor').text(totalSelecionado);
            }
        
            $(document).on('click', '.plus', function() {
                var input = $(this).siblings('input.count');
                var saborId = input.data('saborid');
                var input_max = $(this).parent().find('input.selsabor');
                var capacidadeMaxima = input_max.data('capmax');
                var totalSelecionado = 0;
        
                // Calcular o total selecionado para todos os sabores
                $('.count').each(function() {
                    totalSelecionado += parseInt($(this).val());
                });
        
                if ((totalSelecionado + 1) <= capacidadeMaxima) {
                    input.val(parseInt(input.val()) + 1);
                    console.log(parseInt(input.val()));
                } else {
                    // Excedeu a capacidade máxima, você pode exibir uma mensagem ou tomar outra ação aqui.
                    console.log('Não permite mais fatias');
                }
        
                // Atualizar o totalSelecionado após a adição
                atualizarTotalSelecionado();
            });
        
            $(document).on('click', '.minus', function(){
                var input = $(this).siblings('input.count');
                var saborId = input.data('saborid');
                input.val(parseInt(input.val()) - 1);
                if (input.val() < 0) {
                    input.val(0);
                }
        
                // Atualizar o totalSelecionado após a subtração
                atualizarTotalSelecionado();
            });
    });
  </script>
{% endblock scripts %}




  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
